{"ast":null,"code":"import { getCartList, changeCount, delSelect } from '@/api/cart';\nimport { Toast } from 'vant';\nexport default {\n  namespaced: true,\n  state() {\n    return {\n      cartList: []\n    };\n  },\n  mutations: {\n    // 提供设置cartlist的mutation\n    setCartlist(state, newList) {\n      state.cartList = newList;\n    },\n    // 点击选中的复选框进行取反\n    toggleChecked(state, id) {\n      const goods = state.cartList.find(item => item.goods_id === id);\n      goods.isChecked = !goods.isChecked;\n    },\n    // 点击全选按钮设置全部复选框选中\n    toggleAllChecked(state, flag) {\n      state.cartList.forEach(item => {\n        item.isChecked = flag;\n      });\n    },\n    // 修改本地的数量\n    changeCount(state, {\n      goodsId,\n      goodsNum\n    }) {\n      const goods = state.cartList.find(item => item.goods_id === goodsId);\n      goods.goods_num = goodsNum;\n    }\n  },\n  getters: {\n    // 求所有商品累加总数\n    cartTotal(state) {\n      return state.cartList.reduce((sum, item) => sum + item.goods_num, 0);\n    },\n    // 选中商品的数组\n    selCartList(state) {\n      return state.cartList.filter(item => item.isChecked);\n    },\n    // 选中商品的总数\n    selCount(state, getters) {\n      return getters.selCartList.reduce((sum, item) => sum + item.goods_num, 0);\n    },\n    // 选中商品总价\n    selPrice(state, getters) {\n      return getters.selCartList.reduce((sum, item) => sum + item.goods_num * item.goods.goods_price_min, 0).toFixed(2);\n    },\n    isAllChecked(state) {\n      return state.cartList.every(item => item.isChecked);\n    }\n  },\n  actions: {\n    // actions默认传参为context,context.commit调用mutations\n    // 获去后台购物车内数据\n    async getCartAction(context) {\n      const {\n        data\n      } = await getCartList();\n      data.list.forEach(item => {\n        item.isChecked = true;\n      });\n      // console.log(data)\n      context.commit('setCartlist', data.list);\n    },\n    // 改变后台与本地中购物车商品数量\n    async changeCountAction(context, obj) {\n      const {\n        goodsNum,\n        goodsId,\n        goodsSkuId\n      } = obj;\n      // 先本地修改\n      context.commit('changeCount', {\n        goodsId,\n        goodsNum\n      });\n      await changeCount(goodsId, goodsNum, goodsSkuId);\n    },\n    // 删除购物车中商品\n    async delAction(context) {\n      const selectCartList = context.getters.selCartList;\n      const CartIds = selectCartList.map(item => item.id);\n      await delSelect(CartIds);\n      Toast('删除成功');\n      // 重新拉去购物车数据\n      context.dispatch('getCartAction');\n    }\n  }\n};","map":{"version":3,"names":["getCartList","changeCount","delSelect","Toast","namespaced","state","cartList","mutations","setCartlist","newList","toggleChecked","id","goods","find","item","goods_id","isChecked","toggleAllChecked","flag","forEach","goodsId","goodsNum","goods_num","getters","cartTotal","reduce","sum","selCartList","filter","selCount","selPrice","goods_price_min","toFixed","isAllChecked","every","actions","getCartAction","context","data","list","commit","changeCountAction","obj","goodsSkuId","delAction","selectCartList","CartIds","map","dispatch"],"sources":["D:/vue/vue-demo/src/store/modules/cart.js"],"sourcesContent":["import { getCartList, changeCount, delSelect } from '@/api/cart'\r\nimport { Toast } from 'vant'\r\nexport default {\r\n  namespaced: true,\r\n  state () {\r\n    return {\r\n      cartList: []\r\n    }\r\n  },\r\n  mutations: {\r\n    // 提供设置cartlist的mutation\r\n    setCartlist (state, newList) {\r\n      state.cartList = newList\r\n    },\r\n    // 点击选中的复选框进行取反\r\n    toggleChecked (state, id) {\r\n      const goods = state.cartList.find(item => item.goods_id === id)\r\n      goods.isChecked = !goods.isChecked\r\n    },\r\n    // 点击全选按钮设置全部复选框选中\r\n    toggleAllChecked (state, flag) {\r\n      state.cartList.forEach(item => {\r\n        item.isChecked = flag\r\n      })\r\n    },\r\n    // 修改本地的数量\r\n    changeCount (state, { goodsId, goodsNum }) {\r\n      const goods = state.cartList.find(item => item.goods_id === goodsId)\r\n      goods.goods_num = goodsNum\r\n    }\r\n  },\r\n  getters: {\r\n    // 求所有商品累加总数\r\n    cartTotal (state) {\r\n      return state.cartList.reduce((sum, item) => sum + item.goods_num, 0)\r\n    },\r\n    // 选中商品的数组\r\n    selCartList (state) {\r\n      return state.cartList.filter(item => item.isChecked)\r\n    },\r\n    // 选中商品的总数\r\n    selCount (state, getters) {\r\n      return getters.selCartList.reduce((sum, item) => sum + item.goods_num, 0)\r\n    },\r\n    // 选中商品总价\r\n    selPrice (state, getters) {\r\n      return getters.selCartList.reduce((sum, item) => sum + item.goods_num * item.goods.goods_price_min, 0).toFixed(2)\r\n    },\r\n    isAllChecked (state) {\r\n      return state.cartList.every(item => item.isChecked)\r\n    }\r\n  },\r\n\r\n  actions: {\r\n    // actions默认传参为context,context.commit调用mutations\r\n    // 获去后台购物车内数据\r\n    async getCartAction (context) {\r\n      const { data } = await getCartList()\r\n      data.list.forEach(item => {\r\n        item.isChecked = true\r\n      })\r\n      // console.log(data)\r\n      context.commit('setCartlist', data.list)\r\n    },\r\n\r\n    // 改变后台与本地中购物车商品数量\r\n    async changeCountAction (context, obj) {\r\n      const { goodsNum, goodsId, goodsSkuId } = obj\r\n      // 先本地修改\r\n      context.commit('changeCount', { goodsId, goodsNum })\r\n      await changeCount(goodsId, goodsNum, goodsSkuId)\r\n    },\r\n\r\n    // 删除购物车中商品\r\n    async delAction (context) {\r\n      const selectCartList = context.getters.selCartList\r\n      const CartIds = selectCartList.map(item => item.id)\r\n      await delSelect(CartIds)\r\n      Toast('删除成功')\r\n      // 重新拉去购物车数据\r\n      context.dispatch('getCartAction')\r\n    }\r\n  }\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}